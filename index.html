<!doctype html>
<!--
Single-file "YouTube Football Live" browser

How to use
1. Get a Google API key with YouTube Data API v3 enabled:
   https://console.developers.google.com/
2. Replace the value of API_KEY below with your API key.
   IMPORTANT: Putting the API key in a client-side HTML file exposes it publicly.
   - For testing/local usage this is fine; for production please proxy requests server-side
     or restrict the key by HTTP referrers in Google Cloud Console.
3. Open this file in a browser (file:// may work, but use a simple local server for best results).
   Example quick server: `npx http-server .` or `python -m http.server 8000`

Notes & limitations
- This single-file app calls YouTube Data API directly from the browser and thus exposes your API key.
- YouTube API quotas apply. Avoid aggressive polling and consider server-side caching for production.
- The app searches for live videos (eventType=live) and shows a grid. Clicking a card opens the YouTube embed player in a modal.
-->

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>YouTube Football Live (Single HTML)</title>

  <!-- Bootstrap 5 (CDN) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{--card-radius:12px;--accent:#ff4d4f}
    body{background:linear-gradient(180deg,#071033 0%, #021226 100%);color:#e6eef8;font-family:Inter,system-ui,Arial;margin:0;padding:20px}
    .app-shell{max-width:1150px;margin:0 auto;background:rgba(255,255,255,0.02);border-radius:12px;padding:18px}
    .card.stream-card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.08));border:0;border-radius:var(--card-radius);cursor:pointer;transition:transform .18s ease,box-shadow .18s ease}
    .card.stream-card:hover{transform:translateY(-6px);box-shadow:0 12px 30px rgba(0,0,0,0.6)}
    .stream-thumb{width:100%;height:170px;object-fit:cover;display:block;border-top-left-radius:var(--card-radius);border-top-right-radius:var(--card-radius)}
    .stream-meta{padding:12px;color:#e6eef8}
    .badge-live{background:linear-gradient(90deg,var(--accent),#ff7b6b);color:white;font-weight:700}
    .small-muted{color:#a9b5c8;font-size:.85rem}
    .search-row .form-control, .search-row .form-select { background: rgba(255,255,255,0.02); color: #e6eef8; border: 1px solid rgba(255,255,255,0.04); }
    .search-row .btn { white-space: nowrap; }
    @media(min-width:992px){ .stream-thumb{height:200px} }
    .footer-note{color:#9fb0cf;font-size:0.85rem}
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="d-flex align-items-center mb-3 gap-3">
      <h4 class="mb-0">Football Live — YouTube</h4>

      <div class="ms-auto w-100 search-row d-flex gap-2 align-items-center" style="max-width:880px">
        <select id="modeSelect" class="form-select" style="width:220px">
          <option value="football live">Football (football live)</option>
          <option value="soccer live">Soccer (soccer live)</option>
          <option value="premier league live">Premier League live</option>
          <option value="laliga live">LaLiga live</option>
        </select>

        <input id="searchInput" class="form-control" placeholder="Search (team, match, channel)">

        <button id="searchBtn" class="btn btn-primary">Search</button>
        <button id="refreshBtn" class="btn btn-outline-light">Refresh</button>
      </div>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <strong>Live Matches</strong>
        <div class="footer-note">Click a card to open the YouTube player</div>
      </div>
      <small id="statusText" class="text-muted">Loading...</small>
    </div>

    <div id="grid" class="row g-3"></div>

    <div class="text-center mt-3">
      <button id="loadMore" class="btn btn-outline-light" style="display:none">Load more</button>
    </div>

    <div class="mt-4 footer-note text-center">Built with YouTube Data API v3 — remember to protect your API key for production.</div>
  </div>

  <!-- Player modal -->
  <div class="modal fade" id="playerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 id="playerTitle" class="modal-title">Live Player</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body p-0">
          <div id="playerWrap" style="position:relative;padding-top:56.25%"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ===== CONFIG =====
    // Replace with your API key (YouTube Data API v3). Exposing this key in client-side code is insecure.
    const API_KEY = 'REPLACE_WITH_YOUR_API_KEY';

    // ===== UI elements =====
    const grid = document.getElementById('grid');
    const statusText = document.getElementById('statusText');
    const searchBtn = document.getElementById('searchBtn');
    const searchInput = document.getElementById('searchInput');
    const refreshBtn = document.getElementById('refreshBtn');
    const modeSelect = document.getElementById('modeSelect');
    const loadMoreBtn = document.getElementById('loadMore');

    const playerModal = new bootstrap.Modal(document.getElementById('playerModal'));
    const playerWrap = document.getElementById('playerWrap');
    const playerTitle = document.getElementById('playerTitle');

    // ===== state =====
    let nextPageToken = null;
    let lastQuery = modeSelect.value || 'football live';

    // ===== helpers =====
    function escapeHtml(s) {
      if (!s) return '';
      return String(s).replace(/[&<>"']/g, (m) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;', "'":'&#039;'}[m]));
    }

    function createCard(item, viewers) {
      // item: search item (id.videoId + snippet)
      const videoId = item.id.videoId;
      const sn = item.snippet || {};
      const thumb = (sn.thumbnails && (sn.thumbnails.high || sn.thumbnails.medium || sn.thumbnails.default))
        ? (sn.thumbnails.high || sn.thumbnails.medium || sn.thumbnails.default).url
        : `https://i.ytimg.com/vi/${videoId}/hqdefault.jpg`;

      const col = document.createElement('div');
      col.className = 'col-12 col-sm-6 col-md-4 col-lg-3';

      const card = document.createElement('div');
      card.className = 'card stream-card';
      card.onclick = () => openPlayer(videoId, sn.title);

      const viewerText = viewers ? `${Number(viewers).toLocaleString()} watching` : '';

      card.innerHTML = `
        <img class="stream-thumb" src="${thumb}" alt="${escapeHtml(sn.title)}" />
        <div class="stream-meta">
          <div class="d-flex justify-content-between align-items-start mb-1">
            <div style="min-width:0">
              <div class="fw-bold text-truncate" title="${escapeHtml(sn.title)}">${escapeHtml(sn.title)}</div>
              <div class="small-muted text-truncate" title="${escapeHtml(sn.channelTitle)}">${escapeHtml(sn.channelTitle)}</div>
            </div>
            <div class="text-end ms-2">
              <div class="badge badge-live mb-1 px-2 py-1">LIVE</div>
              <div class="small-muted">${viewerText}</div>
            </div>
          </div>
        </div>
      `;

      col.appendChild(card);
      return col;
    }

    // Fetch search results from YouTube Data API (client-side)
    // Query must include eventType=live to find live streams
    async function ytSearch(query, pageToken = '', maxResults = 24) {
      if (!API_KEY || API_KEY === 'REPLACE_WITH_YOUR_API_KEY') {
        throw new Error('You must set API_KEY in the HTML file before running.');
      }

      const params = new URLSearchParams({
        key: API_KEY,
        part: 'snippet',
        q: query,
        type: 'video',
        eventType: 'live',
        maxResults: String(maxResults)
      });
      if (pageToken) params.set('pageToken', pageToken);

      const url = `https://www.googleapis.com/youtube/v3/search?${params.toString()}`;
      const resp = await fetch(url);
      if (!resp.ok) {
        const txt = await resp.text();
        throw new Error(`YouTube search failed: ${resp.status} ${resp.statusText} - ${txt}`);
      }
      return resp.json();
    }

    // Fetch liveStreamingDetails (concurrentViewers) for a set of video IDs (comma separated)
    async function ytVideoDetails(videoIdsCsv) {
      const params = new URLSearchParams({
        key: API_KEY,
        part: 'liveStreamingDetails,statistics',
        id: videoIdsCsv
      });
      const url = `https://www.googleapis.com/youtube/v3/videos?${params.toString()}`;
      const resp = await fetch(url);
      if (!resp.ok) {
        // don't fatal; return empty
        return null;
      }
      return resp.json();
    }

    // Perform search and render results; if append=true will append to grid (used for Load more)
    async function performSearch(query, append = false, pageToken = '') {
      if (!append) {
        grid.innerHTML = '';
        statusText.textContent = 'Searching...';
        nextPageToken = null;
      } else {
        statusText.textContent = 'Loading more...';
      }

      try {
        const data = await ytSearch(query, pageToken, 24);
        if (!append && (!data.items || data.items.length === 0)) {
          grid.innerHTML = '<div class="text-muted">No live matches found.</div>';
          statusText.textContent = 'No results';
          loadMoreBtn.style.display = 'none';
          return;
        }

        // get video IDs to fetch viewers
        const ids = (data.items || []).map(i => i.id.videoId).filter(Boolean);
        let viewersMap = {};
        if (ids.length) {
          const details = await ytVideoDetails(ids.join(','));
          if (details && details.items) {
            details.items.forEach(v => {
              const id = v.id;
              // liveStreamingDetails.concurrentViewers may be string
              const cv = v.liveStreamingDetails && v.liveStreamingDetails.concurrentViewers ? v.liveStreamingDetails.concurrentViewers : null;
              // fallback to statistics.viewCount for non-live or if concurrent missing
              const sc = v.statistics && v.statistics.viewCount ? v.statistics.viewCount : null;
              viewersMap[id] = cv || sc || null;
            });
          }
        }

        // render cards
        (data.items || []).forEach(item => {
          grid.appendChild(createCard(item, viewersMap[item.id.videoId]));
        });

        nextPageToken = data.nextPageToken || null;
        loadMoreBtn.style.display = nextPageToken ? 'inline-block' : 'none';
        statusText.textContent = `${(data.items || []).length} loaded`;
      } catch (err) {
        console.error(err);
        statusText.textContent = 'Search failed';
        if (!append) grid.innerHTML = `<div class="text-danger">Failed to load results: ${escapeHtml(err.message)}</div>`;
      }
    }

    function openPlayer(videoId, title) {
      playerTitle.textContent = title || 'Live Player';
      playerWrap.innerHTML = `
        <iframe
          src="https://www.youtube.com/embed/${encodeURIComponent(videoId)}?autoplay=1&rel=0&modestbranding=1"
          frameborder="0"
          allow="autoplay; encrypted-media"
          allowfullscreen
          style="position:absolute;top:0;left:0;width:100%;height:100%;">
        </iframe>
      `;
      playerModal.show();
    }

    // Clean up iframe on close to stop playback
    document.getElementById('playerModal').addEventListener('hidden.bs.modal', () => {
      playerWrap.innerHTML = '';
    });

    // UI events
    searchBtn.addEventListener('click', () => {
      const q = (searchInput.value.trim() || modeSelect.value || 'football live');
      lastQuery = q;
      performSearch(q, false);
    });

    searchInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') searchBtn.click();
    });

    refreshBtn.addEventListener('click', () => {
      performSearch(lastQuery || modeSelect.value, false);
    });

    modeSelect.addEventListener('change', () => {
      const q = modeSelect.value;
      searchInput.value = '';
      lastQuery = q;
      performSearch(q, false);
    });

    loadMoreBtn.addEventListener('click', () => {
      if (!nextPageToken) return;
      performSearch(lastQuery || modeSelect.value, true, nextPageToken);
    });

    // initial load
    (async () => {
      if (!API_KEY || API_KEY === 'REPLACE_WITH_YOUR_API_KEY') {
        statusText.textContent = 'Set API_KEY in the file to enable search';
        grid.innerHTML = `<div class="text-warning">Please edit this file and set <code>API_KEY</code> at top of the script with your YouTube Data API key.</div>`;
        return;
      }
      lastQuery = modeSelect.value || 'football live';
      await performSearch(lastQuery, false);
    })();
  </script>
</body>
</html>
